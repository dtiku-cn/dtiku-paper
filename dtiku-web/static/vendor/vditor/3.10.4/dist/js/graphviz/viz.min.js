!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.Viz=n()}(this,function(){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},e=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e};function t(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var d=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r,t=arguments[n];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},i=(e(n,[{key:"render",value:function(n,i){var o=this;return new Promise(function(r,t){var e=o.nextId++;o.listeners[e]=function(e,n){e?t(new Error(e.message,e.fileName,e.lineNumber)):r(n)},o.worker.postMessage({id:e,src:n,options:i})})}}]),n);function n(e){var t=this;a(this,n),this.worker=e,this.listeners=[],this.nextId=0,this.worker.addEventListener("message",function(e){var n=e.data.id,r=e.data.error,e=e.data.result;t.listeners[n](r,e),delete t.listeners[n]})}function s(e,i){a(this,s);var o=e();this.render=function(r,t){return new Promise(function(e,n){try{e(i(o,r,t))}catch(e){n(e)}})}}function u(){return"devicePixelRatio"in window&&1<window.devicePixelRatio?window.devicePixelRatio:1}function l(e,n){var n=1<arguments.length&&void 0!==n?n:{},r=n.scale,i=void 0===r?u():r,r=n.mimeType,o=void 0===r?"image/png":r,r=n.quality,a=void 0===r?1:r;return new Promise(function(r,n){var t=new Image;t.onload=function(){var e=document.createElement("canvas");e.width=t.width*i,e.height=t.height*i,e.getContext("2d").drawImage(t,0,0,e.width,e.height),e.toBlob(function(e){var n=new Image;n.src=URL.createObjectURL(e),n.width=t.width,n.height=t.height,r(n)},o,a)},t.onerror=function(e){e="error"in e?e.error:new Error("Error loading SVG");n(e)},t.src="data:image/svg+xml;base64,"+btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,n){return String.fromCharCode("0x"+n)}))})}function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.workerURL,r=e.worker,t=e.Module,e=e.render;if(a(this,c),void 0!==n)this.wrapper=new i(new Worker(n));else if(void 0!==r)this.wrapper=new i(r);else if(void 0!==t&&void 0!==e)this.wrapper=new s(t,e);else{if(void 0===c.Module||void 0===c.render)throw new Error("Must specify workerURL or worker option, Module and render options, or include one of full.render.js or lite.render.js after viz.js.");this.wrapper=new s(c.Module,c.render)}}return e(c,[{key:"renderString",value:function(e){for(var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.format,r=void 0===r?"svg":r,t=n.engine,t=void 0===t?"dot":t,i=n.files,o=void 0===i?[]:i,i=n.images,a=void 0===i?[]:i,i=n.yInvert,i=void 0!==i&&i,n=n.nop,n=void 0===n?0:n,d=0;d<a.length;d++)o.push({path:a[d].path,data:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg width="'+a[d].width+'" height="'+a[d].height+'"></svg>'});return this.wrapper.render(e,{format:r,engine:t,files:o,images:a,yInvert:i,nop:n})}},{key:"renderSVGElement",value:function(e){return this.renderString(e,d({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},{format:"svg"})).then(function(e){return(new DOMParser).parseFromString(e,"image/svg+xml").documentElement})}},{key:"renderImageElement",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.scale,t=n.mimeType,i=n.quality;return this.renderString(e,d({},n,{format:"svg"})).then(function(e){return("object"===("undefined"==typeof fabric?"undefined":o(fabric))&&fabric.loadSVGFromString?function(e,n){var n=1<arguments.length&&void 0!==n?n:{},r=void 0===(r=n.scale)?u():r,t=void 0===(t=n.mimeType)?"image/png":t,n=n.quality,o=void 0===n?1:n,a=r,d=void 0;return"image/jpeg"==t?d="jpeg":"image/png"==t&&(d="png"),new Promise(function(t,i){fabric.loadSVGFromString(e,function(e,n){0==e.length&&i(new Error("Error loading SVG with Fabric"));var r=document.createElement("canvas"),r=(r.width=n.width,r.height=n.height,new fabric.Canvas(r,{enableRetinaScaling:!1})),e=fabric.util.groupSVGElements(e,n),e=(r.add(e).renderAll(),new Image);e.src=r.toDataURL({format:d,multiplier:a,quality:o}),e.width=n.width,e.height=n.height,t(e)})})}:l)(e,{scale:r,mimeType:t,quality:i})})}},{key:"renderJSONObject",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.format;return this.renderString(e,d({},n,{format:r="json"===r&&"json0"===r?r:"json"})).then(function(e){return JSON.parse(e)})}}]),c});